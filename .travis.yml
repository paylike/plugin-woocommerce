language: php
dist: trusty
php:
- 7.2
addons:
  chrome: stable
env:
  global:
  - USE_STEWARD_MASTER=1
  - SELENIUM_SERVER_VERSION="3.8.1"
  - CHROMEDRIVER_VERSION="2.36"
  matrix:
  - BROWSER=chrome
install:
- composer install --no-interaction
- SELENIUM_PATH=$(./vendor/bin/steward install $SELENIUM_SERVER_VERSION --no-interaction)
- echo "Selenium server path:" $SELENIUM_PATH
- if [ "$BROWSER" = "chrome" ]; then mkdir chromedriver; wget -q -t 3 https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip;
  unzip chromedriver_linux64 -d chromedriver; fi
- if [ "$BROWSER" = "chrome" ]; then export CHROMEDRIVER_PATH=./chromedriver/chromedriver;
  fi
before_script:
- java -jar $SELENIUM_PATH -role hub -enablePassThrough false -log selenium-server.log
  &
- until $(echo | nc localhost 4444); do sleep 1; echo Waiting for selenium-server
  to start...; done;
- if [ "$BROWSER" = "chrome" ]; then java -Dwebdriver.chrome.driver="$CHROMEDRIVER_PATH"
  -jar $SELENIUM_PATH -role node -port 8910 -log selenium-node-1.log -enablePassThrough
  false & fi
- sleep 3
script:
- ./vendor/bin/steward run staging $BROWSER --group="woocommerce_quick_test" -vv
after_success:
- "./vendor/bin/steward results -vvv"
- ./vendor/bin/steward run staging $BROWSER --group="woocommerce_full_test" -vv
- "./vendor/bin/steward results -vvv"
- ./vendor/bin/steward run staging $BROWSER --group="woocommerce_version_log" -vv
- "./vendor/bin/steward results -vvv"
after_script:
- "./vendor/bin/steward results -vvv"
cache:
  directories:
  - "$HOME/.composer/cache"
deploy:
  provider: s3
  access_key_id: AKIAIAPIOPFUB745V5EQ
  secret_access_key:
    secure: BsTSvxE0ZOsJ32ZCeCwoMPX5xQqdcWau1VFumsAhdH/kVjUC3XgsX3U704bqWSb2OJoUm0bWMIpjTNsm7WqBbAVWopGo/tCSppRSe3HKVoYkFLSIeVC3vx6ribKL24tb8jZZyl9dp2AU6f0fgF5qPS6X2DhkTMMZqP+e/lZ9W7N5GxnZeqCFj++NJ3J0/LGl0O11pxr4SD4OWEgEJnWcwjvKT1TaNWBmsKyT/EZBIl2y8Ln1eqGxy0oWSJv4mZBlgdzQQ2kJdbKff/fkq0ZiyUG63F8OFpsd+TEXqj1gJQ3PSIPwr9lREfujtDYAAAMY3uK8k3WbFohGZX0QPba7WgQ/howWymFjnNf4MYkYUMrLE6lCXY0vR+dwc/wUhjnObdPLK4L2YJPFAKnb/nFGqlf+YGG9YLcYCDBccAJQghnTmesZcJUBZTU23O3CPVFhaGiASF140ElPXlPpdF1Z5j/0mBZ2KiAUezsrsBdNnDeN7ayO7pcjoj+WZroYDklsvg2+DWgcCLmTmDCsj8fT53wzbLL+WDUHZTV4z2ZzmTW++kr0Cz4eRQ1bBzVKd7FVkc3A+h9F4Vv6YitRpe44lmBKbuIhhcnl6nqhcXt7BbKMVFQDEXNvIL+MEOzW3H/r5GlUBj7sVE+JcFvCh6LBKQHoEDrsSaBrqBSmVlgd30U=
  bucket: paylike-travis-logs
  local-dir: logs
  acl: private
